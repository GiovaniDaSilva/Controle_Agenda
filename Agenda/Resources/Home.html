<html lang="pr-bt">
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    {p_links_comum_pagina}


    <!--Seleção da linha da tabela-->
    <script src="https://cdn.datatables.net/select/1.3.1/js/dataTables.select.min.js"></script>
    <link rel="stylesheet" href="https://cdn.datatables.net/select/1.3.1/css/select.bootstrap4.min.css" />

    <!--Ordenação por Data-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.8.4/moment.min.js"></script>
    <script src="https://cdn.datatables.net/plug-ins/1.10.10/sorting/datetime-moment.js"></script>


    <style>
        [p_style_comum_pagina] 
        
      
        .thead-blue {
            color: black;
            background-color: #0099cc;
            border:none ;
            border-color: #0099cc;
        }

        td.descricao {
            max-width: 300px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;            
        }

        .botaoSubMenu{
            border:none;
        }

        .labelSpan{
            font-weight: bold; 
            color: black;
            font-size: 12px; 
        }

        .labelTotais {
            font-weight: bold;
            font-size: 14px;
            border: none;
        }
        .corVerdeVivo {
            color: #339933;
        }
    </style>

    {p_titulo_pagina}

</head>


<body class="Fundo">
    <header>
        {p_menu_pagina}

    </header>

    <!--Sub Menu-->
    
        <div class="form-row" style="margin-top: 10px; margin-left: 20px">
            <div class="col-md-10">
                <a href="CadastroAtividade" id="btnCadastroAtivdade" class=" btn btn-success btn-outline-light botaoSubMenu">Nova Atividade</a>
            </div>

            <div class="col-md-1 float-right">
                <span class="Fundo labelTotais">Total do Dia:</span>
                <span class="Fundo labelTotais corVerdeVivo">08:30</span>
            </div>
            <div class="col-md-1 float-right">
                <span class="Fundo labelTotais">Da Atividade:</span>
                <span class="Fundo labelTotais corVerdeVivo">08:00</span>
            </div>
            
            
        </div>


    <div class="container-fluid">
        <form method="post" id="form_Filtro" style="margin-top: 10px; margin-bottom: 10px">
            <div class="input-group mb-3 input-group-sm">
                <div class="input-group-prepend">

                    <span style="border:none" class="input-group-text Fundo labelSpan"><b>A partir de:</b></span>
                    <input type="date" class="form-control" id="data_ini" name="data_ini" form="form_Filtro">
                    &nbsp;
                    <span style="border:none" class="input-group-text Fundo labelSpan"><b>Tipo de Atividade:</b></span>
                    <select class="custom-select" select id="cbTipo" name="tipoAtividade" form="form_Filtro">
                       {p_tipos_atividades_filtro}
                    </select>
                    &nbsp;
                    <div class="input-group-append">
                        <button class="btn btn-outline-secondary" type="submit" form="form_Filtro">Aplicar</button>
                    </div>
                </div>
            </div>
        </form>
    </div>
   
    <!--Div como oculta, exibe apos a carga da grid para evitar piscar enquanto redimensiona-->
    <div id="dadosHome" class="container-fluid" style="display: none">
        <div style="margin-top: 20px;" class="container-fluid">
            <table id="Dados" class="table nowrap table-hover table-info table-striped table-sm" cellspacing="0" > 
                <thead class="thead-dark">
                    <tr>
                        <th>ID</th>
                        <th>Data</th>
                        <th>Tipo</th>
                        <th>Codigo</th>
                        <th>Horas</th>
                        <th>Descrição</th>
                        <th>Acao</th>
                    </tr>
                </thead>
                <tbody>
                    {p_linhas_tabela}
                </tbody>
            </table>
        </div>         
        <div class="form-group" style="margin-top: 40px">
            <label for="comment" class="label">Descrição:</label>
            <textarea readonly class="form-control" rows="10" id="txtdescricao" name="info"></textarea>
        </div>
    </div>

    <script>


        $(document).ready(function () {

            
            [p_inicializa_campos_filtro]

            tb = $('#Dados').DataTable({
                "scrollY": "400px", //Altura da grid com scroll
                "scrollCollapse": true,
                select: {
                    style: 'single' //permitir selecionar apenas uma linha
                },
                order: [[1, 'desc']], //ordem padrão: coluna Data em ordem Decrescente

                oLanguage: { sUrl: '//cdn.datatables.net/plug-ins/1.10.20/i18n/Portuguese-Brasil.json' },

                columnDefs: [
                    {//coluna ID
                        targets: 0, searchable: false, orderable: false, visible: false, className: 'noVis'
                    },
                    {//coluna Data
                        type: 'date-br',
                        targets: 1
                    },
                    {//coluna Código
                        targets: 3,
                        render: function (data, type, row, meta) {
                            var codigo = row[3];
                            //Alterar para o ID_TIPO
                            if (row[2] == 'PBI') {
                                return '<a href="http://tfs.cetil.com.br:8080/tfs/CETIL/Suprimentos/_workitems?_a=edit&id=' + codigo + '">' + codigo + '</a>';
                            } else {
                                return '<a href="http://sg.govbr.com.br/sgcetil/servlet/br.com.cetil.sg.producao.hsodetso?' + codigo + '">' + codigo + '</a>';
                            }

                        }
                    },
                    {//coluna Descrição
                        targets: 5
                    },
                    {//coluna Editar
                        render: function (data, type, row) {
                            var id = row[0];
                            return "<a href='/CadastroAtividade?id=" + id + "' class='btn btn-outline-primary'>Editar</a>"
                            },
                        targets: 6,
                        width: "5%" //Ajusta o tamanho para 5% ou o tamanho minimo necessário
                    }   
                ],

                initComplete: function () {               
                    //Exibir a diva somente após completar a carga
                    $('#dadosHome').show();
                    tb.columns.adjust();
                },

            });
            $('.dataTables_length').addClass('bs-select');
            
            $.fn.dataTable.moment('DD/MM/YYYY');

            //Seleção da Atividade
            tb.on('select.dt deselect.dt', function () {
                var rows = $('tr.selected');
                var rowData = tb.rows(rows).data();
                var id = 0;

                //limpa o campo descricao
                document.getElementById('txtdescricao').value = ""

                $.each($(rowData), function (key, value) {                           
                    id = value[0]
                });
                if (id > 0) {
              
                    $.ajax({
                        url: 'home_get_descricao',
                        type: 'POST',
                        dataType: 'text',//'json',
                        data: id,

                        success: function (descricao) {
                            document.getElementById('txtdescricao').value = descricao;
                        },

                        error: function (descricao) {
                            alert(descricao);
                        }
                    });
                }
            });          
            

        });

        //Ordenação da coluna data
        jQuery.extend(jQuery.fn.dataTableExt.oSort, {
            "date-br-pre": function (a) {
                if (a == null || a == "") {
                    return 0;
                }
                var brDatea = a.split('/');
                return (brDatea[2] + brDatea[1] + brDatea[0]) * 1;
            },

            "date-br-asc": function (a, b) {
                return ((a < b) ? -1 : ((a > b) ? 1 : 0));
            },

            "date-br-desc": function (a, b) {
                return ((a < b) ? 1 : ((a > b) ? -1 : 0));
            }
        });


    </script>
    
</body>


</html>